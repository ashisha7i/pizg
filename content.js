chrome.runtime.onMessage.addListener(function (request, sender, sendResponse) {
  if (request.action === 'clicked_browser_action') { var decodedString; try { let b64Data = getSelectedText(); if (!b64Data) { throw new Error("Nothing selected? Please make sure that you have selected the text to decode."); } var strData = atob(b64Data); var charData = strData.split('').map(function (x) { return x.charCodeAt(0); }); var binData = new Uint8Array(charData); var data = pako.inflate(binData); decodedString = new TextDecoder('utf-8').decode(new Uint8Array(data)); } catch (err) { console.dir(err); decodedString = "ERROR : Please verify the selected text and try again."; } sendResponse({ results: decodedString }); } else if (request.action = 'prettify_action') { console.log("Prettify CALLED " + request.type); var prettyString = "--"; if (request.type === 'XML') { prettyString = vkbeautify.xml(); } sendResponse({ results: "A pretty string" });}}); function getSelectedText() { var text = ""; if (typeof window.getSelection != "undefined") { text = window.getSelection().toString(); } else if (typeof document.selection != "undefined" && document.selection.type == "Text") { text = document.selection.createRange().text;} return text;}
